# ThockPick 시스템 아키텍처

## 📋 프로젝트 개요

ThockPick은 Google Sheets를 기반으로 한 키보드 부품(스위치, 보강판) 검색 및 유튜브 타건음 추천 서비스입니다.

사용자의 취향(리니어/택타일 등)을 입력받아 적합한 부품을 검색하고, 해당 부품의 타건음을 들을 수 있는 유튜브 영상을 추천합니다.

## 🏗️ 전체 아키텍처

```
┌─────────────────┐
│  Google Sheets  │  ← 사용자가 스위치/보강판 정보 입력
└────────┬────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────┐
│                    Spring Boot Server                    │
│                                                           │
│  ┌──────────────────────────────────────────────────┐   │
│  │         1. Data Sync Layer (스케줄러)             │   │
│  │  - Google Sheets API 주기적 호출                  │   │
│  │  - 데이터 변경 감지 및 동기화                      │   │
│  └──────────────┬───────────────────────────────────┘   │
│                 │                                         │
│                 ▼                                         │
│  ┌──────────────────────────────────────────────────┐   │
│  │      2. Persistence Layer (영속성 저장)           │   │
│  │  - JPA + RDB (MySQL/PostgreSQL)                   │   │
│  │  - 스위치, 보강판, 유튜브 정보 저장                │   │
│  └──────────────┬───────────────────────────────────┘   │
│                 │                                         │
│     ┌───────────┴───────────┐                            │
│     ▼                       ▼                            │
│  ┌────────────────┐   ┌──────────────────┐              │
│  │  3. Search     │   │  4. Cache        │              │
│  │  Elasticsearch │   │  Redis           │              │
│  │                │   │                  │              │
│  │ - 텍스트 검색   │   │ - 인기 부품      │              │
│  │ - 필터링       │   │ - 추천 매핑      │              │
│  │ - 자동완성     │   │ - 세션 데이터    │              │
│  └────────────────┘   └──────────────────┘              │
│           │                     │                         │
│           └──────────┬──────────┘                         │
│                      ▼                                    │
│  ┌──────────────────────────────────────────────────┐   │
│  │         5. Service Layer (비즈니스 로직)          │   │
│  │  - 부품 검색 서비스                               │   │
│  │  - 유튜브 추천 서비스                             │   │
│  │  - 사용자 취향 매칭                               │   │
│  └──────────────────────────────────────────────────┘   │
│                      │                                    │
│                      ▼                                    │
│  ┌──────────────────────────────────────────────────┐   │
│  │         6. REST API Controller                    │   │
│  │  - GET  /api/switches                             │   │
│  │  - GET  /api/switches/search                      │   │
│  │  - GET  /api/plates                               │   │
│  │  - GET  /api/recommendations                      │   │
│  └──────────────────────────────────────────────────┘   │
└───────────────────────────┬─────────────────────────────┘
                            │
                            ▼
                    ┌───────────────┐
                    │  Client App   │
                    │  (Web/Mobile) │
                    └───────────────┘
```

## 🔄 데이터 플로우

### 1. 데이터 동기화 플로우
```
Google Sheets → Scheduler → Validation → JPA → RDB
                                              ↓
                                         Elasticsearch 인덱싱
```

### 2. 검색 플로우
```
Client Request → Controller → Service
                                 ↓
                     ┌───────────┴──────────┐
                     ▼                      ▼
                 Redis Cache          Elasticsearch
                 (Cache Hit)          (Cache Miss)
                     ↓                      ↓
                     └──────────┬───────────┘
                                ▼
                           Response
```

### 3. 추천 플로우
```
사용자 취향 입력 → 부품 검색 → RDB에서 관련 유튜브 정보 조회
                                        ↓
                                Redis 캐싱
                                        ↓
                              유튜브 링크 반환
```

## 📦 레이어별 상세 설명

### Layer 1: Data Entry (데이터 입력)
- **역할**: 커뮤니티 기반 데이터 수집
- **도구**: Google Sheets
- **데이터**:
  - 스위치 정보 (이름, 타입, 무게, 재질, 가격 등)
  - 보강판 정보 (재질, 타입, 호환성 등)
  - 유튜브 타건음 영상 링크

### Layer 2: Sync Layer (동기화 레이어)
- **역할**: Google Sheets 데이터를 주기적으로 가져와 DB와 동기화
- **기술**: Spring Scheduler + Google Sheets API
- **주요 기능**:
  - Cron 기반 주기적 동기화 (예: 1시간마다)
  - 데이터 변경 감지 (diff)
  - 유효성 검증
  - 에러 핸들링 및 로깅

### Layer 3: Persistence Layer (영속성 레이어)
- **역할**: 데이터의 영구 저장 및 관계 관리
- **기술**: Spring Data JPA + MySQL/PostgreSQL
- **주요 엔티티**:
  - `Switch`: 스위치 정보
  - `Plate`: 보강판 정보
  - `Video`: 유튜브 영상 정보
  - `SwitchVideo`: 스위치-영상 연관 관계

### Layer 4: Search Engine (검색 엔진)
- **역할**: 고속 텍스트 검색 및 필터링
- **기술**: Elasticsearch
- **인덱싱 데이터**:
  - 스위치명, 제조사, 타입
  - 보강판명, 재질
  - 검색 키워드, 태그
- **주요 기능**:
  - 전문 검색 (Full-text search)
  - 필터링 (타입, 가격대, 무게 등)
  - 자동완성
  - 관련도 기반 정렬

### Layer 5: Caching Layer (캐싱 레이어)
- **역할**: 자주 조회되는 데이터 캐싱으로 응답 속도 향상
- **기술**: Redis
- **캐싱 대상**:
  - 인기 스위치 Top 10
  - 추천 스위치 목록
  - 스위치-유튜브 매핑
  - 검색 결과 (단기 캐싱)
- **캐시 전략**:
  - TTL: 1시간 ~ 24시간
  - Cache-Aside Pattern
  - 데이터 동기화 시 캐시 무효화

### Layer 6: Service Layer (서비스 레이어)
- **역할**: 비즈니스 로직 처리
- **주요 서비스**:
  - `SwitchService`: 스위치 검색, 필터링, 추천
  - `PlateService`: 보강판 검색, 호환성 체크
  - `RecommendationService`: 사용자 취향 기반 추천
  - `SyncService`: Google Sheets 동기화
  - `VideoService`: 유튜브 영상 관리

## 🎯 핵심 기능

### 1. 스위치 검색
- 키워드 기반 검색 (Elasticsearch)
- 필터링: 타입(리니어/택타일/클릭키), 무게, 가격대, 제조사
- 정렬: 관련도, 인기도, 가격순

### 2. 유튜브 추천
- 스위치별 타건음 영상 매핑
- 보강판 조합별 영상 추천
- 인기 영상 우선 정렬

### 3. 취향 기반 추천
- 사용자 선호도 입력 (타입, 무게, 소리 특성)
- 매칭 알고리즘으로 최적 스위치 추천
- 관련 유튜브 영상 함께 제공

## 🔒 비기능 요구사항

### 성능
- API 응답 시간: < 200ms (캐시 히트 시)
- 검색 응답 시간: < 500ms
- 동시 사용자: 1000명 지원

### 확장성
- 수평 확장 가능한 구조 (Stateless)
- Redis Cluster 지원
- Elasticsearch 샤딩

### 안정성
- Google Sheets API 장애 시에도 서비스 유지 (기존 DB 데이터 활용)
- 캐시 장애 시 DB Fallback
- 에러 로깅 및 모니터링

### 보안
- API Rate Limiting
- 입력 데이터 검증
- XSS, SQL Injection 방어

## 📊 모니터링 및 로깅

### 모니터링 항목
- API 응답 시간
- 캐시 히트율
- Elasticsearch 쿼리 성능
- Google Sheets 동기화 상태

### 로깅
- 동기화 로그 (성공/실패, 변경 건수)
- 검색 쿼리 로그 (인기 검색어 분석)
- 에러 로그 (Slack/Email 알림)

## 🚀 향후 확장 가능성

1. **사용자 기능 추가**
   - 회원가입/로그인
   - 위시리스트
   - 리뷰 및 평점

2. **AI 추천**
   - 타건음 오디오 분석
   - ML 기반 추천 알고리즘

3. **커뮤니티**
   - 사용자 리뷰
   - 조합 공유 (스위치 + 보강판 + 키캡)

4. **파트너십**
   - 쇼핑몰 연동
   - 가격 비교
   - 구매 링크 제공
